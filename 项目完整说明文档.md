# Coze.com API è°ƒç”¨æ’ä»¶ - å®Œæ•´è¯´æ˜æ–‡æ¡£

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåœ¨ **coze.cn** æ’ä»¶ä¸­é€šè¿‡ **ä¸ªäººè®¿é—®ä»¤ç‰Œ(Personal Access Token)** è°ƒç”¨ **coze.com** å·¥ä½œæµçš„è·¨å¹³å°é›†æˆè§£å†³æ–¹æ¡ˆã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- åœ¨coze.cnæ’ä»¶ä¸­è°ƒç”¨coze.comçš„å·¥ä½œæµAPI
- ä½¿ç”¨ä¸ªäººè®¿é—®ä»¤ç‰Œè¿›è¡Œå®‰å…¨è®¤è¯
- æä¾›å¥å£®çš„é”™è¯¯å¤„ç†å’Œè¿æ¥æµ‹è¯•
- æ”¯æŒå¤šç§APIæ“ä½œï¼ˆæ‰§è¡Œå·¥ä½œæµã€èŠå¤©ç­‰ï¼‰
- å¹³å°å…¼å®¹æ€§ä¼˜åŒ–ï¼Œè§£å†³Cozeå¹³å°ç‰¹æœ‰çš„å¯¼å…¥é—®é¢˜

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
geminiè°ƒç”¨apiã€coze.comä¸­è½¬ã€‘/
â”œâ”€â”€ ğŸ“ æ ¸å¿ƒæ–‡ä»¶
â”‚   â”œâ”€â”€ coze_plugin_complete.py      # å®Œæ•´ç‰ˆæ’ä»¶ï¼ˆæ¨èï¼‰
â”‚   â”œâ”€â”€ coze_plugin_simplified.py    # ç®€åŒ–ç‰ˆæ’ä»¶ï¼ˆå…¼å®¹æ€§ä¼˜å…ˆï¼‰
â”‚   â”œâ”€â”€ coze_plugin_integration.py   # é›†æˆæ¨¡å—
â”‚   â”œâ”€â”€ coze_chatflow_client.py      # èŠå¤©æµå®¢æˆ·ç«¯
â”‚   â””â”€â”€ coze_personal_token_auth.py  # ä¸ªäººä»¤ç‰Œè®¤è¯
â”‚
â”œâ”€â”€ ğŸ“ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ coze_config.json            # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ chatflow_config.json        # èŠå¤©æµé…ç½®
â”‚   â”œâ”€â”€ plugin_config_example.json  # æ’ä»¶é…ç½®ç¤ºä¾‹
â”‚   â””â”€â”€ requirements.txt             # ä¾èµ–åŒ…åˆ—è¡¨
â”‚
â””â”€â”€ ğŸ“ æ–‡æ¡£
    â”œâ”€â”€ é¡¹ç›®å®Œæ•´è¯´æ˜æ–‡æ¡£.md          # æœ¬æ–‡æ¡£
    â”œâ”€â”€ CODE_QUALITY_ENHANCEMENT_SUGGESTIONS.md  # ä»£ç è´¨é‡å»ºè®®
    â”œâ”€â”€ COZE_PLATFORM_COMPATIBILITY_GUIDE.md     # å¹³å°å…¼å®¹æ€§æŒ‡å—
    â””â”€â”€ API_CONNECTION_PERFORMANCE_ANALYSIS.md   # æ€§èƒ½åˆ†ææŠ¥å‘Š
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šé€‰æ‹©æ’ä»¶ç‰ˆæœ¬

#### æ¨èï¼šå®Œæ•´ç‰ˆæ’ä»¶ (`coze_plugin_complete.py`)
- åŠŸèƒ½å®Œæ•´ï¼ŒåŒ…å«æ‰€æœ‰ç‰¹æ€§
- å·²è§£å†³å¹³å°å…¼å®¹æ€§é—®é¢˜
- åŒ…å«å®¹é”™å¯¼å…¥æœºåˆ¶

#### å¤‡é€‰ï¼šç®€åŒ–ç‰ˆæ’ä»¶ (`coze_plugin_simplified.py`)
- ç§»é™¤æ‰€æœ‰ç±»å‹æ³¨è§£
- æœ€å¤§åŒ–å¹³å°å…¼å®¹æ€§
- é€‚ç”¨äºä¸¥æ ¼çš„å¹³å°ç¯å¢ƒ

### æ­¥éª¤2ï¼šé…ç½®ä¸ªäººè®¿é—®ä»¤ç‰Œ

1. **è·å–ä»¤ç‰Œ**ï¼š
   - è®¿é—® [Coze.com å¼€å‘è€…æ§åˆ¶å°](https://www.coze.com/open)
   - åˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œ
   - ç¡®ä¿ä»¤ç‰Œå…·æœ‰ä»¥ä¸‹æƒé™ï¼š
     - `workflows:read`
     - `workflows:execute`
     - `chat:write`
     - `chat:read`

2. **é…ç½®ä»¤ç‰Œ**ï¼š
   ```json
   {
     "access_token": "pat_your_token_here",
     "base_url": "https://api.coze.com",
     "workflow_id": "your_workflow_id"
   }
   ```

### æ­¥éª¤3ï¼šéƒ¨ç½²åˆ°Cozeå¹³å°

1. **ä¸Šä¼ æ’ä»¶æ–‡ä»¶**ï¼š
   - é€‰æ‹© `coze_plugin_complete.py` æˆ– `coze_plugin_simplified.py`
   - ä¸Šä¼ åˆ°coze.cnæ’ä»¶å¼€å‘ç¯å¢ƒ

2. **é…ç½®æ’ä»¶å‚æ•°**ï¼š
   ```python
   # åœ¨æ’ä»¶ä¸­é…ç½®
   def handler(args):
       # ä»argsä¸­è·å–é…ç½®
       access_token = args.get('access_token')
       workflow_id = args.get('workflow_id')
       user_input = args.get('user_input', '')
       
       # å…¶ä»–é…ç½®...
   ```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. å·¥ä½œæµæ‰§è¡Œ

```python
# åŸºæœ¬ç”¨æ³•
client = CozeChatflowClient(access_token="your_token")
result = client.run_workflow(
    workflow_id="your_workflow_id",
    user_input="ç”¨æˆ·è¾“å…¥å†…å®¹"
)
```

### 2. è¿æ¥æµ‹è¯•

æ”¯æŒå¤šç§æµ‹è¯•æ¨¡å¼ï¼š

```python
# å¿«é€Ÿæ¨¡å¼ï¼ˆæ¨èï¼Œ2-3ç§’ï¼‰
result = client.test_connection(mode='fast')

# æ ‡å‡†æ¨¡å¼ï¼ˆ8-12ç§’ï¼‰
result = client.test_connection(mode='standard')

# è·³è¿‡æµ‹è¯•ï¼ˆ0ç§’ï¼Œé€‚ç”¨äºå¯ä¿¡ç¯å¢ƒï¼‰
result = client.test_connection(mode='skip')
```

### 3. é”™è¯¯å¤„ç†

```python
try:
    result = client.run_workflow(workflow_id, user_input)
except CozeAPIError as e:
    print(f"APIé”™è¯¯: {e}")
except CozeNetworkError as e:
    print(f"ç½‘ç»œé”™è¯¯: {e}")
except Exception as e:
    print(f"æœªçŸ¥é”™è¯¯: {e}")
```

## ğŸ› ï¸ å¹³å°å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ

### é—®é¢˜ï¼šç±»å‹å¯¼å…¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
SyntaxError: cannot import name 'Input' from 'typings'
```

### è§£å†³æ–¹æ¡ˆï¼šå®¹é”™å¯¼å…¥æœºåˆ¶

```python
# åœ¨æ’ä»¶ä¸­å®ç°çš„å®¹é”™å¯¼å…¥
try:
    from typings import Input, Output
except ImportError:
    # å¦‚æœæ— æ³•å¯¼å…¥ typingsï¼Œä½¿ç”¨ typing.Any ä½œä¸ºæ›¿ä»£
    from typing import Any
    Input = Any
    Output = Any
```

### æœ€ä½³å®è·µ

1. **æ¨¡å—å¯¼å…¥ç­–ç•¥**ï¼š
   - ä¼˜å…ˆä½¿ç”¨Pythonæ ‡å‡†åº“
   - å¯¹å¹³å°ç‰¹å®šæ¨¡å—ä½¿ç”¨å®¹é”™å¯¼å…¥
   - æä¾›å¤‡ç”¨æ–¹æ¡ˆ

2. **ç±»å‹æ³¨è§£å…¼å®¹æ€§**ï¼š
   - ä½¿ç”¨ç®€åŒ–çš„ç±»å‹æ³¨è§£
   - é¿å…å¤æ‚çš„æ³›å‹ç±»å‹
   - æä¾›ç±»å‹åˆ«å

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### è¿æ¥æµ‹è¯•æ€§èƒ½å¯¹æ¯”

| æµ‹è¯•æ¨¡å¼ | è€—æ—¶ | é€‚ç”¨åœºæ™¯ |
|---------|------|----------|
| è·³è¿‡æµ‹è¯• | 0ç§’ | å¯ä¿¡ç¯å¢ƒï¼Œæ€§èƒ½ä¼˜å…ˆ |
| å¿«é€Ÿæ¨¡å¼ | 2-3ç§’ | ä¸€èˆ¬ä½¿ç”¨ï¼Œå¹³è¡¡æ€§èƒ½å’Œå¯é æ€§ |
| æ ‡å‡†æ¨¡å¼ | 8-12ç§’ | ä¸¥æ ¼éªŒè¯ï¼Œå¯é æ€§ä¼˜å…ˆ |

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®**ï¼š
   ```python
   config = {
       'connection_test_mode': 'fast',
       'timeout': 2,
       'max_retries': 1,
       'skip_connection_test': False  # æ ¹æ®ç¯å¢ƒè°ƒæ•´
   }
   ```

2. **ç½‘ç»œä¼˜åŒ–**ï¼š
   - ä½¿ç”¨CDNåŠ é€Ÿ
   - é…ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
   - å®æ–½é‡è¯•æœºåˆ¶

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### 1. ä»¤ç‰Œå®‰å…¨

```python
# âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å®‰å…¨é…ç½®
access_token = os.getenv('COZE_ACCESS_TOKEN')

# âŒ é”™è¯¯ï¼šç¡¬ç¼–ç ä»¤ç‰Œ
access_token = "pat_hardcoded_token"
```

### 2. æ•æ„Ÿä¿¡æ¯è„±æ•

```python
def mask_token(token):
    """è„±æ•è®¿é—®ä»¤ç‰Œ"""
    if not token:
        return "None"
    return f"{token[:8]}***{token[-4:]}"
```

### 3. è¾“å…¥éªŒè¯

```python
def validate_input(user_input):
    """éªŒè¯ç”¨æˆ·è¾“å…¥"""
    if not user_input or not isinstance(user_input, str):
        raise ValueError("ç”¨æˆ·è¾“å…¥å¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²")
    if len(user_input) > 10000:
        raise ValueError("ç”¨æˆ·è¾“å…¥è¿‡é•¿")
    return True
```

## ğŸ§ª æµ‹è¯•å’Œè°ƒè¯•

### 1. åŸºæœ¬æµ‹è¯•

```python
# æµ‹è¯•è¿æ¥
client = CozeChatflowClient(access_token="your_token")
connection_result = client.test_connection(mode='fast')
print(f"è¿æ¥æµ‹è¯•ç»“æœ: {connection_result}")

# æµ‹è¯•å·¥ä½œæµ
workflow_result = client.run_workflow(
    workflow_id="test_workflow",
    user_input="æµ‹è¯•è¾“å…¥"
)
print(f"å·¥ä½œæµç»“æœ: {workflow_result}")
```

### 2. è°ƒè¯•æ¨¡å¼

```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# ä½¿ç”¨è°ƒè¯•é…ç½®
client = CozeChatflowClient(
    access_token="your_token",
    debug=True,
    verbose=True
)
```

## ğŸ”§ ä»£ç è´¨é‡å¢å¼ºå»ºè®®

### 1. æ¶æ„ä¼˜åŒ–

- **é…ç½®ç®¡ç†**ï¼šä½¿ç”¨é…ç½®ç±»ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®
- **ä¾èµ–æ³¨å…¥**ï¼šæé«˜ä»£ç çš„å¯æµ‹è¯•æ€§
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šåˆ†ç¦»å…³æ³¨ç‚¹ï¼Œæé«˜ä»£ç å¤ç”¨æ€§

### 2. é”™è¯¯å¤„ç†å¢å¼º

- **ç»†ç²’åº¦å¼‚å¸¸**ï¼šå®šä¹‰æ›´å¤šç‰¹å®šçš„å¼‚å¸¸ç±»å‹
- **é”™è¯¯æ¢å¤**ï¼šå®æ–½è‡ªåŠ¨é‡è¯•å’Œé™çº§ç­–ç•¥
- **ç”¨æˆ·å‹å¥½**ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

### 3. ç›‘æ§å’Œæ—¥å¿—

- **ç»“æ„åŒ–æ—¥å¿—**ï¼šä½¿ç”¨JSONæ ¼å¼è®°å½•ç»“æ„åŒ–ä¿¡æ¯
- **æ€§èƒ½ç›‘æ§**ï¼šæ·»åŠ æ€§èƒ½ç›‘æ§è£…é¥°å™¨
- **æŒ‡æ ‡æ”¶é›†**ï¼šæ”¶é›†å…³é”®ä¸šåŠ¡æŒ‡æ ‡

### 4. å®‰å…¨æ€§å¢å¼º

- **è¾“å…¥éªŒè¯**ï¼šä¸¥æ ¼éªŒè¯æ‰€æœ‰è¾“å…¥å‚æ•°
- **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**ï¼šè„±æ•æ—¥å¿—ä¸­çš„æ•æ„Ÿä¿¡æ¯
- **è®¿é—®æ§åˆ¶**ï¼šå®æ–½é€‚å½“çš„è®¿é—®æ§åˆ¶æœºåˆ¶

## ğŸ“‹ é…ç½®å‚è€ƒ

### åŸºæœ¬é…ç½® (`coze_config.json`)

```json
{
  "access_token": "pat_your_token_here",
  "base_url": "https://api.coze.com",
  "timeout": 30,
  "max_retries": 3,
  "connection_test_mode": "fast",
  "skip_connection_test": false,
  "debug": false,
  "verbose": false
}
```

### å·¥ä½œæµé…ç½® (`chatflow_config.json`)

```json
{
  "workflow_id": "your_workflow_id",
  "default_parameters": {
    "temperature": 0.7,
    "max_tokens": 2000
  },
  "retry_config": {
    "max_retries": 3,
    "backoff_factor": 1.5
  }
}
```

### æ’ä»¶é…ç½®ç¤ºä¾‹ (`plugin_config_example.json`)

```json
{
  "plugin_name": "coze_api_caller",
  "version": "1.0.0",
  "description": "è°ƒç”¨Coze.com APIçš„æ’ä»¶",
  "parameters": {
    "access_token": {
      "type": "string",
      "required": true,
      "description": "Coze.comä¸ªäººè®¿é—®ä»¤ç‰Œ"
    },
    "workflow_id": {
      "type": "string",
      "required": true,
      "description": "è¦æ‰§è¡Œçš„å·¥ä½œæµID"
    },
    "user_input": {
      "type": "string",
      "required": true,
      "description": "ç”¨æˆ·è¾“å…¥å†…å®¹"
    }
  }
}
```

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### 1. å¯¼å…¥é”™è¯¯

**é—®é¢˜**ï¼š`ModuleNotFoundError: No module named 'typings'`

**è§£å†³**ï¼šä½¿ç”¨ç®€åŒ–ç‰ˆæ’ä»¶æˆ–ç¡®ä¿å®¹é”™å¯¼å…¥æœºåˆ¶æ­£å¸¸å·¥ä½œ

### 2. è¿æ¥è¶…æ—¶

**é—®é¢˜**ï¼šè¿æ¥æµ‹è¯•è€—æ—¶è¿‡é•¿

**è§£å†³**ï¼š
- ä½¿ç”¨å¿«é€Ÿæ¨¡å¼ï¼š`connection_test_mode='fast'`
- æˆ–è·³è¿‡æµ‹è¯•ï¼š`skip_connection_test=True`

### 3. è®¤è¯å¤±è´¥

**é—®é¢˜**ï¼š`401 Unauthorized`

**è§£å†³**ï¼š
- æ£€æŸ¥è®¿é—®ä»¤ç‰Œæ˜¯å¦æ­£ç¡®
- ç¡®è®¤ä»¤ç‰Œæƒé™æ˜¯å¦è¶³å¤Ÿ
- éªŒè¯ä»¤ç‰Œæ˜¯å¦è¿‡æœŸ

### 4. å·¥ä½œæµæ‰§è¡Œå¤±è´¥

**é—®é¢˜**ï¼šå·¥ä½œæµè¿”å›é”™è¯¯

**è§£å†³**ï¼š
- æ£€æŸ¥å·¥ä½œæµIDæ˜¯å¦æ­£ç¡®
- éªŒè¯è¾“å…¥å‚æ•°æ ¼å¼
- æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ—¥å¿—åˆ†æ

å¯ç”¨è¯¦ç»†æ—¥å¿—ä»¥è·å–æ›´å¤šè°ƒè¯•ä¿¡æ¯ï¼š

```python
# åœ¨æ’ä»¶ä¸­å¯ç”¨è°ƒè¯•
client = CozeChatflowClient(
    access_token="your_token",
    debug=True,
    verbose=True
)
```

### ç¯å¢ƒæ£€æŸ¥

```python
# æ£€æŸ¥è¿è¡Œç¯å¢ƒ
def check_environment():
    import sys
    print(f"Pythonç‰ˆæœ¬: {sys.version}")
    print(f"å¯ç”¨æ¨¡å—: {sys.modules.keys()}")
    
    # æ£€æŸ¥å…³é”®æ¨¡å—
    modules_to_check = ['json', 'urllib', 'typing', 'runtime']
    for module in modules_to_check:
        try:
            __import__(module)
            print(f"âœ… {module}: å¯ç”¨")
        except ImportError:
            print(f"âŒ {module}: ä¸å¯ç”¨")
```

## ğŸ“ˆ ç‰ˆæœ¬å†å²

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… åŸºæœ¬å·¥ä½œæµè°ƒç”¨åŠŸèƒ½
- âœ… ä¸ªäººè®¿é—®ä»¤ç‰Œè®¤è¯
- âœ… è¿æ¥æµ‹è¯•å’Œé”™è¯¯å¤„ç†
- âœ… å¹³å°å…¼å®¹æ€§ä¿®å¤
- âœ… æ€§èƒ½ä¼˜åŒ–
- âœ… å®Œæ•´æ–‡æ¡£

### æœªæ¥è®¡åˆ’
- ğŸ”„ OAuth 2.0 è®¤è¯æ”¯æŒ
- ğŸ“Š æ›´å¤šAPIç«¯ç‚¹æ”¯æŒ
- ğŸ”§ å›¾å½¢åŒ–é…ç½®ç•Œé¢
- ğŸ“ˆ é«˜çº§ç›‘æ§å’Œåˆ†æ

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤çŠ¶æ€**: æ´»è·ƒç»´æŠ¤
**è®¸å¯è¯**: MIT License